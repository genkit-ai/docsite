---
import Default from '@astrojs/starlight/components/Head.astro';

const { title } = Astro.locals.starlightRoute.entry.data;
const id = Astro.locals.starlightRoute.entry["id"];
const { head } = Astro.locals.starlightRoute;

let finalTitle = title;
if (id.startsWith('go/')) {
    finalTitle = title + ' - Go - Genkit';
}
if (id.startsWith('python/')) {
    finalTitle = title + ' - Python - Genkit' ;
}
if (id.startsWith('docs/')) {
    finalTitle = title + ' - JS - Genkit';
}
---
<title>{finalTitle}</title>
{head.filter(({ tag }) => tag !== 'title').map(({ tag: Tag, attrs, content }) => <Tag {...attrs} set:html={content} />)}

<!-- Critical inline script - MUST run before any content renders -->
<script is:inline>
(function() {
  // Extract language from URL immediately
  const params = new URLSearchParams(window.location.search);
  const currentLang = params.get('lang') || 'js';
  
  // Set attribute on html element for CSS targeting
  document.documentElement.setAttribute('data-genkit-lang', currentLang);
})();
</script>

<!-- Critical CSS to prevent FOUC -->
<style is:inline>
/* Hide ALL language content by default */
.lang-content {
  display: none !important;
  visibility: hidden !important;
}

/* Show ONLY the content for the current language */
html[data-genkit-lang="js"] .lang-content[data-lang="js"] {
  display: block !important;
  visibility: visible !important;
}

html[data-genkit-lang="go"] .lang-content[data-lang="go"] {
  display: block !important;
  visibility: visible !important;
}

html[data-genkit-lang="python"] .lang-content[data-lang="python"] {
  display: block !important;
  visibility: visible !important;
}

/* Language selector pills styling */
.lang-pill {
  background: var(--sl-color-bg, #fff);
  color: var(--sl-color-text, #000);
  border: 1px solid var(--sl-color-gray-4, #ccc);
}

html[data-genkit-lang="js"] .lang-pill[data-lang="js"],
html[data-genkit-lang="go"] .lang-pill[data-lang="go"],
html[data-genkit-lang="python"] .lang-pill[data-lang="python"] {
  background: var(--sl-color-accent, #0066cc) !important;
  color: var(--sl-color-white, #fff) !important;
  border-color: var(--sl-color-accent, #0066cc) !important;
}
</style>