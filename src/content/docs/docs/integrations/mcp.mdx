---
title: Model Context Protocol (MCP) Plugin
description: Learn how to integrate MCP servers with Genkit across JavaScript, Go, and Python for extensible tool and resource management.
---

import LanguageSelector from '../../../../components/LanguageSelector.astro';
import CopyMarkdownButton from '../../../../components/CopyMarkdownButton.astro';
import LanguageContent from '../../../../components/LanguageContent.astro';

<div style="display: flex; justify-content: space-between; align-items: center; gap: 1rem; margin: 1rem 0 1rem 0;">
  <LanguageSelector />
  <CopyMarkdownButton />
</div>

The Model Context Protocol (MCP) plugin enables integration between Genkit and the [Model Context Protocol](https://modelcontextprotocol.io), an open standard for connecting AI applications with external tools, resources, and prompts. MCP allows you to:

- **Consume MCP tools and resources** from external servers as a client
- **Expose Genkit tools and prompts** as an MCP server for other applications
- **Manage multiple MCP connections** for complex workflows

## Installation and Setup

<LanguageContent lang="js">
Install the MCP plugin:

    ```bash
    npm install genkit @genkit-ai/mcp
    ```

    Basic setup:

    ```ts
    import { genkit } from 'genkit';
    import { googleAI } from '@genkit-ai/googleai';
    import { createMcpHost } from '@genkit-ai/mcp';

    const ai = genkit({
      plugins: [googleAI()],
    });

    // Create MCP host to manage multiple servers
    const mcpHost = createMcpHost({
      name: 'myMcpClients',
      mcpServers: {
        fs: {
          command: 'npx',
          args: ['-y', '@modelcontextprotocol/server-filesystem', process.cwd()],
        },
        memory: {
          command: 'npx',
          args: ['-y', '@modelcontextprotocol/server-memory'],
        },
      },
    });
    ```

</LanguageContent>

<LanguageContent lang="go">
Import the MCP package:

    ```bash
    go get github.com/firebase/genkit/go/plugins/mcp
    ```

    Basic setup:

    ```go
    package main

    import (
        "context"
        "log"
        "github.com/firebase/genkit/go/genkit"
        "github.com/firebase/genkit/go/plugins/mcp"
    )

    func main() {
        ctx := context.Background()
        g, err := genkit.Init(ctx)
        if err != nil {
            log.Fatal(err)
        }

        // Create MCP manager for multiple servers
        manager, err := mcp.NewMCPManager(mcp.MCPManagerOptions{
            Name: "my-app",
            MCPServers: []mcp.MCPServerConfig{
                {
                    Name: "time-server",
                    Config: mcp.MCPClientOptions{
                        Name: "mcp-server-time",
                        Stdio: &mcp.StdioConfig{
                            Command: "uvx",
                            Args:    []string{"mcp-server-time"},
                        },
                    },
                },
            },
        })
        if err != nil {
            log.Fatal(err)
        }
    }
    ```

</LanguageContent>

<LanguageContent lang="python">
Install the MCP plugin:

    ```bash
    pip install genkit-mcp
    ```

    Basic setup:

    ```python
    import asyncio
    from genkit.ai import Genkit
    from genkit.plugins.mcp import MCPPlugin

    async def main():
        ai = Genkit(
            plugins=[
                MCPPlugin(
                    name="my-mcp-client",
                    servers={
                        "filesystem": {
                            "command": "npx",
                            "args": ["-y", "@modelcontextprotocol/server-filesystem", "."],
                        },
                        "memory": {
                            "command": "npx",
                            "args": ["-y", "@modelcontextprotocol/server-memory"],
                        },
                    },
                ),
            ],
        )

    if __name__ == "__main__":
        asyncio.run(main())
    ```

</LanguageContent>

## MCP Client Usage

### Connecting to MCP Servers

<LanguageContent lang="js">
#### Multiple Servers with MCP Host

    ```ts
    import { createMcpHost } from '@genkit-ai/mcp';

    const mcpHost = createMcpHost({
      name: 'myMcpClients',
      mcpServers: {
        // Filesystem server
        fs: {
          command: 'npx',
          args: ['-y', '@modelcontextprotocol/server-filesystem', process.cwd()],
        },
        // Memory server
        memory: {
          command: 'npx',
          args: ['-y', '@modelcontextprotocol/server-memory'],
        },
        // Remote HTTP server
        remote: {
          url: 'https://api.example.com/mcp',
          headers: {
            'Authorization': 'Bearer your-token',
          },
        },
      },
      rawToolResponses: false, // Process responses for better compatibility
    });

    // Use tools from all connected servers
    const { text } = await ai.generate({
      model: googleAI.model('gemini-2.5-flash'),
      prompt: `Analyze all files in ${process.cwd()} and remember key findings.`,
      tools: await mcpHost.getActiveTools(ai),
      resources: await mcpHost.getActiveResources(ai),
    });

    // Clean up when done
    await mcpHost.close();
    ```

    #### Single Server with MCP Client

    ```ts
    import { createMcpClient } from '@genkit-ai/mcp';

    const fsClient = createMcpClient({
      name: 'myFileSystemClient',
      mcpServer: {
        command: 'npx',
        args: ['-y', '@modelcontextprotocol/server-filesystem', process.cwd()],
      },
    });

    await fsClient.ready();

    // Get tools from this specific client
    const fsTools = await fsClient.getActiveTools(ai);

    const { text } = await ai.generate({
      model: googleAI.model('gemini-2.5-flash'),
      prompt: 'List files in the current directory',
      tools: fsTools,
    });

    await fsClient.disable();
    ```

</LanguageContent>

<LanguageContent lang="go">
#### Multiple Servers with Manager

    ```go
    manager, err := mcp.NewMCPManager(mcp.MCPManagerOptions{
        Name: "my-app",
        MCPServers: []mcp.MCPServerConfig{
            {
                Name: "filesystem",
                Config: mcp.MCPClientOptions{
                    Name: "filesystem-server",
                    Stdio: &mcp.StdioConfig{
                        Command: "npx",
                        Args:    []string{"-y", "@modelcontextprotocol/server-filesystem", "."},
                    },
                },
            },
            {
                Name: "time",
                Config: mcp.MCPClientOptions{
                    Name: "time-server",
                    Stdio: &mcp.StdioConfig{
                        Command: "uvx",
                        Args:    []string{"mcp-server-time"},
                    },
                },
            },
        },
    })
    if err != nil {
        log.Fatal(err)
    }

    // Get all tools from all active servers
    tools, err := manager.GetActiveTools(ctx, g)
    if err != nil {
        log.Fatal(err)
    }

    // Use tools in generation
    resp, err := genkit.Generate(ctx, g,
        ai.WithModel(myModel),
        ai.WithPrompt("What time is it and list files in current directory?"),
        ai.WithTools(tools...),
    )
    if err != nil {
        log.Fatal(err)
    }
    ```

    #### Single Server Client

    ```go
    client, err := mcp.NewGenkitMCPClient(mcp.MCPClientOptions{
        Name: "time-client",
        Stdio: &mcp.StdioConfig{
            Command: "uvx",
            Args:    []string{"mcp-server-time"},
        },
    })
    if err != nil {
        log.Fatal(err)
    }

    // Get a specific tool
    timeTool, err := client.GetTool(ctx, g, "get_current_time")
    if err != nil {
        log.Fatal(err)
    }

    // Use the tool
    resp, err := genkit.Generate(ctx, g,
        ai.WithModel(myModel),
        ai.WithPrompt("What time is it?"),
        ai.WithTools(timeTool),
    )
    if err != nil {
        log.Fatal(err)
    }
    ```

</LanguageContent>

<LanguageContent lang="python">
#### Multiple Servers

    ```python
    from genkit.plugins.mcp import MCPPlugin

    mcp_plugin = MCPPlugin(
        name="my-mcp-client",
        servers={
            "filesystem": {
                "command": "npx",
                "args": ["-y", "@modelcontextprotocol/server-filesystem", "."],
            },
            "memory": {
                "command": "npx",
                "args": ["-y", "@modelcontextprotocol/server-memory"],
            },
            "time": {
                "command": "uvx",
                "args": ["mcp-server-time"],
            },
        },
    )

    ai = Genkit(plugins=[mcp_plugin])

    # Get all available tools
    tools = await mcp_plugin.get_active_tools()

    # Use tools in generation
    response = await ai.generate(
        model="googleai/gemini-2.5-flash",
        prompt="What time is it and what files are in the current directory?",
        tools=tools,
    )
    ```

    #### Single Server

    ```python
    from genkit.plugins.mcp import MCPClient

    client = MCPClient(
        name="time-client",
        server_config={
            "command": "uvx",
            "args": ["mcp-server-time"],
        },
    )

    await client.connect()

    # Get specific tool
    time_tool = await client.get_tool("get_current_time")

    # Use the tool
    response = await ai.generate(
        model="googleai/gemini-2.5-flash",
        prompt="What time is it?",
        tools=[time_tool],
    )

    await client.disconnect()
    ```

</LanguageContent>

### Using MCP Tools and Resources

<LanguageContent lang="js">
```ts
    // Get tools from specific servers
    const fsTools = await mcpHost.getActiveTools(ai, ['fs']);
    const memoryTools = await mcpHost.getActiveTools(ai, ['memory']);

    // Get all tools
    const allTools = await mcpHost.getActiveTools(ai);

    // Get resources
    const resources = await mcpHost.getActiveResources(ai);

    // Get prompts from a specific server
    const prompt = await mcpHost.getPrompt('memory', 'recall_information');

    // Use in generation with specific tools
    const { text } = await ai.generate({
      model: googleAI.model('gemini-2.5-flash'),
      prompt: 'Read the README file and remember its contents',
      tools: [...fsTools, ...memoryTools],
      resources: resources,
    });

    // Tool responses are automatically processed
    // Raw responses can be enabled with rawToolResponses: true
    ```

</LanguageContent>

<LanguageContent lang="go">
```go
    // Get tools from specific server
    timeTool, err := manager.GetTool(ctx, g, "time", "get_current_time")
    if err != nil {
        log.Fatal(err)
    }

    // Get prompt from specific server
    prompt, err := manager.GetPrompt(ctx, g, "time", "time_prompt", nil)
    if err != nil {
        log.Fatal(err)
    }

    // Get all tools from all servers
    allTools, err := manager.GetActiveTools(ctx, g)
    if err != nil {
        log.Fatal(err)
    }

    // Use in generation
    resp, err := genkit.Generate(ctx, g,
        ai.WithModel(myModel),
        ai.WithPrompt("Use available tools to help me"),
        ai.WithTools(allTools...),
    )
    if err != nil {
        log.Fatal(err)
    }

    // Dynamic server management
    err = manager.Connect("weather", mcp.MCPClientOptions{
        Name: "weather-server",
        Stdio: &mcp.StdioConfig{
            Command: "python",
            Args:    []string{"weather_server.py"},
        },
    })
    if err != nil {
        log.Fatal(err)
    }

    // Disconnect when done
    err = manager.Disconnect("weather")
    if err != nil {
        log.Fatal(err)
    }
    ```

</LanguageContent>

<LanguageContent lang="python">
```python
    # Get tools from specific servers
    fs_tools = await mcp_plugin.get_tools_from_server("filesystem")
    memory_tools = await mcp_plugin.get_tools_from_server("memory")

    # Get all available tools
    all_tools = await mcp_plugin.get_active_tools()

    # Get resources
    resources = await mcp_plugin.get_active_resources()

    # Get prompt from specific server
    prompt = await mcp_plugin.get_prompt("memory", "recall_information")

    # Use in generation
    response = await ai.generate(
        model="googleai/gemini-2.5-flash",
        prompt="Read files and remember important information",
        tools=fs_tools + memory_tools,
        resources=resources,
    )

    # Dynamic server management
    await mcp_plugin.connect_server("weather", {
        "command": "python",
        "args": ["weather_server.py"],
    })

    # Disconnect server
    await mcp_plugin.disconnect_server("weather")
    ```

</LanguageContent>

## MCP Server Usage

### Exposing Genkit as MCP Server

<LanguageContent lang="js">
```ts
    import { createMcpServer } from '@genkit-ai/mcp';
    import { StdioServerTransport } from '@modelcontextprotocol/sdk/server/stdio.js';
    import { genkit, z } from 'genkit';

    const ai = genkit({
      plugins: [googleAI()],
    });

    // Define tools to expose
    ai.defineTool(
      {
        name: 'add',
        description: 'Add two numbers together',
        inputSchema: z.object({
          a: z.number(),
          b: z.number()
        }),
        outputSchema: z.number(),
      },
      async ({ a, b }) => a + b
    );

    // Define prompts to expose
    ai.definePrompt(
      {
        name: 'greeting',
        description: 'Generate a friendly greeting',
        input: {
          schema: z.object({
            name: z.string().default('friend').optional(),
          }),
        },
      },
      `Hello {{name}}! How can I help you today?`
    );

    // Define resources to expose
    ai.defineResource(
      {
        name: 'system-info',
        uri: 'system://info',
      },
      async () => ({
        content: [{
          text: `System: ${process.platform}, Node: ${process.version}`,
        }],
      })
    );

    // Create and start MCP server
    const server = createMcpServer(ai, {
      name: 'genkit-calculator',
      version: '1.0.0',
    });

    server.setup().then(async () => {
      await server.start();
      const transport = new StdioServerTransport();
      await server.server?.connect(transport);
    });
    ```

</LanguageContent>

<LanguageContent lang="go">
```go
    package main

    import (
        "context"
        "log"
        "github.com/firebase/genkit/go/ai"
        "github.com/firebase/genkit/go/genkit"
        "github.com/firebase/genkit/go/plugins/mcp"
    )

    func main() {
        ctx := context.Background()
        g, err := genkit.Init(ctx)
        if err != nil {
            log.Fatal(err)
        }

        // Define tools to expose
        addTool := genkit.DefineTool(g, "add", "Add two numbers",
            func(ctx context.Context, input struct{ A, B int }) (int, error) {
                return input.A + input.B, nil
            })

        multiplyTool := genkit.DefineTool(g, "multiply", "Multiply two numbers",
            func(ctx context.Context, input struct{ A, B int }) (int, error) {
                return input.A * input.B, nil
            })

        // Create MCP server with all tools
        server := mcp.NewMCPServer(g, mcp.MCPServerOptions{
            Name:    "genkit-calculator",
            Version: "1.0.0",
        })

        // Or create server with specific tools only
        specificServer := mcp.NewMCPServer(g, mcp.MCPServerOptions{
            Name:    "genkit-math",
            Version: "1.0.0",
            Tools:   []ai.Tool{addTool, multiplyTool},
        })

        // Start the MCP server
        log.Println("Starting MCP server...")
        if err := server.ServeStdio(ctx); err != nil {
            log.Fatal(err)
        }
    }
    ```

</LanguageContent>

<LanguageContent lang="python">
```python
    import asyncio
    from genkit.ai import Genkit
    from genkit.plugins.mcp import MCPServer

    async def main():
        ai = Genkit()

        # Define tools to expose
        @ai.define_tool(
            name="add",
            description="Add two numbers together",
            input_schema={
                "type": "object",
                "properties": {
                    "a": {"type": "number"},
                    "b": {"type": "number"},
                },
                "required": ["a", "b"],
            },
        )
        async def add_tool(a: float, b: float) -> float:
            return a + b

        @ai.define_tool(
            name="multiply",
            description="Multiply two numbers",
            input_schema={
                "type": "object",
                "properties": {
                    "a": {"type": "number"},
                    "b": {"type": "number"},
                },
                "required": ["a", "b"],
            },
        )
        async def multiply_tool(a: float, b: float) -> float:
            return a * b

        # Create MCP server
        server = MCPServer(
            ai=ai,
            name="genkit-calculator",
            version="1.0.0",
        )

        # Start the server
        print("Starting MCP server...")
        await server.serve_stdio()

    if __name__ == "__main__":
        asyncio.run(main())
    ```

</LanguageContent>

## Advanced Configuration

### Transport Options

<LanguageContent lang="js">
```ts
    // Stdio transport (default)
    const mcpHost = createMcpHost({
      mcpServers: {
        local: {
          command: 'node',
          args: ['server.js'],
          env: { DEBUG: '1' },
          cwd: '/path/to/server',
        },
      },
    });

    // HTTP transport
    const httpHost = createMcpHost({
      mcpServers: {
        remote: {
          url: 'https://api.example.com/mcp',
          headers: {
            'Authorization': 'Bearer token',
            'X-API-Key': 'key',
          },
          requestInit: {
            timeout: 30000,
          },
        },
      },
    });

    // Custom transport
    const customHost = createMcpHost({
      mcpServers: {
        custom: {
          transport: myCustomTransport,
        },
      },
    });
    ```

</LanguageContent>

<LanguageContent lang="go">
```go
    // Stdio transport
    client, err := mcp.NewGenkitMCPClient(mcp.MCPClientOptions{
        Name: "stdio-server",
        Stdio: &mcp.StdioConfig{
            Command: "python",
            Args:    []string{"server.py"},
            Env:     []string{"DEBUG=1", "API_KEY=secret"},
        },
    })

    // SSE transport
    sseClient, err := mcp.NewGenkitMCPClient(mcp.MCPClientOptions{
        Name: "sse-server",
        SSE: &mcp.SSEConfig{
            BaseURL: "http://localhost:3000/sse",
        },
    })

    // Disabled client (can be enabled later)
    disabledClient, err := mcp.NewGenkitMCPClient(mcp.MCPClientOptions{
        Name:     "optional-server",
        Disabled: true,
        Stdio: &mcp.StdioConfig{
            Command: "optional-server",
        },
    })
    ```

</LanguageContent>

<LanguageContent lang="python">
```python
    # Stdio transport
    mcp_plugin = MCPPlugin(
        servers={
            "local": {
                "command": "python",
                "args": ["server.py"],
                "env": {"DEBUG": "1", "API_KEY": "secret"},
                "cwd": "/path/to/server",
            },
        },
    )

    # HTTP transport
    http_plugin = MCPPlugin(
        servers={
            "remote": {
                "url": "https://api.example.com/mcp",
                "headers": {
                    "Authorization": "Bearer token",
                    "X-API-Key": "key",
                },
                "timeout": 30,
            },
        },
    )

    # Disabled server
    disabled_plugin = MCPPlugin(
        servers={
            "optional": {
                "command": "optional-server",
                "disabled": True,
            },
        },
    )
    ```

</LanguageContent>

### Error Handling and Lifecycle Management

<LanguageContent lang="js">
```ts
    const mcpHost = createMcpHost({
      name: 'robust-mcp-client',
      mcpServers: {
        fs: {
          command: 'npx',
          args: ['-y', '@modelcontextprotocol/server-filesystem', process.cwd()],
        },
      },
    });

    try {
      // Wait for connections to be established
      await mcpHost.ready();

      // Check server status
      const activeServers = await mcpHost.getActiveServers();
      console.log('Active servers:', activeServers);

      // Use tools with error handling
      const tools = await mcpHost.getActiveTools(ai);

      const { text } = await ai.generate({
        model: googleAI.model('gemini-2.5-flash'),
        prompt: 'List files safely',
        tools: tools,
      });

    } catch (error) {
      console.error('MCP operation failed:', error);
    } finally {
      // Always clean up
      await mcpHost.close();
    }
    ```

</LanguageContent>

<LanguageContent lang="go">
```go
    manager, err := mcp.NewMCPManager(mcp.MCPManagerOptions{
        Name: "robust-app",
        MCPServers: []mcp.MCPServerConfig{
            {
                Name: "filesystem",
                Config: mcp.MCPClientOptions{
                    Name: "fs-server",
                    Stdio: &mcp.StdioConfig{
                        Command: "npx",
                        Args:    []string{"-y", "@modelcontextprotocol/server-filesystem", "."},
                    },
                },
            },
        },
    })
    if err != nil {
        log.Fatal(err)
    }

    // Graceful shutdown
    defer func() {
        if err := manager.Close(); err != nil {
            log.Printf("Error closing MCP manager: %v", err)
        }
    }()

    // Check server health
    tools, err := manager.GetActiveTools(ctx, g)
    if err != nil {
        log.Printf("Failed to get tools: %v", err)
        return
    }

    // Use tools with error handling
    resp, err := genkit.Generate(ctx, g,
        ai.WithModel(myModel),
        ai.WithPrompt("List files safely"),
        ai.WithTools(tools...),
    )
    if err != nil {
        log.Printf("Generation failed: %v", err)
        return
    }
    ```

</LanguageContent>

<LanguageContent lang="python">
```python
    async def robust_mcp_usage():
        mcp_plugin = MCPPlugin(
            name="robust-client",
            servers={
                "filesystem": {
                    "command": "npx",
                    "args": ["-y", "@modelcontextprotocol/server-filesystem", "."],
                },
            },
        )

        try:
            # Wait for connections
            await mcp_plugin.ready()

            # Check server status
            active_servers = await mcp_plugin.get_active_servers()
            print(f"Active servers: {active_servers}")

            # Get tools with error handling
            tools = await mcp_plugin.get_active_tools()

            response = await ai.generate(
                model="googleai/gemini-2.5-flash",
                prompt="List files safely",
                tools=tools,
            )

        except Exception as error:
            print(f"MCP operation failed: {error}")
        finally:
            # Clean up connections
            await mcp_plugin.close()
    ```

</LanguageContent>

## Testing and Development

### Testing Your MCP Server

<LanguageContent lang="js">
```bash
    # Test with MCP Inspector
    npx @modelcontextprotocol/inspector node dist/server.js

    # Test with custom client
    node test-client.js
    ```

    ```ts
    // test-client.js
    import { createMcpClient } from '@genkit-ai/mcp';

    const client = createMcpClient({
      name: 'test-client',
      mcpServer: {
        command: 'node',
        args: ['dist/server.js'],
      },
    });

    await client.ready();

    // Test tools
    const tools = await client.getActiveTools();
    console.log('Available tools:', tools.map(t => t.name));

    // Test prompts
    const prompts = await client.getActivePrompts();
    console.log('Available prompts:', prompts.map(p => p.name));

    await client.disable();
    ```

</LanguageContent>

<LanguageContent lang="go">
```bash
    # Build your server
    go build -o server main.go

    # Test with MCP Inspector
    npx @modelcontextprotocol/inspector ./server

    # Test with custom client
    go run test-client.go
    ```

    ```go
    // test-client.go
    package main

    import (
        "context"
        "log"
        "github.com/firebase/genkit/go/plugins/mcp"
    )

    func main() {
        ctx := context.Background()

        client, err := mcp.NewGenkitMCPClient(mcp.MCPClientOptions{
            Name: "test-client",
            Stdio: &mcp.StdioConfig{
                Command: "./server",
            },
        })
        if err != nil {
            log.Fatal(err)
        }

        // Test server capabilities
        tools, err := client.GetActiveTools(ctx, nil)
        if err != nil {
            log.Fatal(err)
        }

        log.Printf("Available tools: %d", len(tools))

        // Clean up
        client.Close()
    }
    ```

</LanguageContent>

<LanguageContent lang="python">
```bash
    # Test with MCP Inspector
    npx @modelcontextprotocol/inspector python server.py

    # Test with custom client
    python test_client.py
    ```

    ```python
    # test_client.py
    import asyncio
    from genkit.plugins.mcp import MCPClient

    async def test_server():
        client = MCPClient(
            name="test-client",
            server_config={
                "command": "python",
                "args": ["server.py"],
            },
        )

        await client.connect()

        # Test server capabilities
        tools = await client.get_active_tools()
        print(f"Available tools: {len(tools)}")

        prompts = await client.get_active_prompts()
        print(f"Available prompts: {len(prompts)}")

        await client.disconnect()

    if __name__ == "__main__":
        asyncio.run(test_server())
    ```

</LanguageContent>

## Best Practices

### Security Considerations

1. **Validate MCP server sources**: Only connect to trusted MCP servers
2. **Sanitize inputs**: Validate all data passed to MCP tools
3. **Limit permissions**: Run MCP servers with minimal required permissions
4. **Monitor resource usage**: Track memory and CPU usage of MCP processes

### Performance Optimization

1. **Connection pooling**: Reuse MCP connections when possible
2. **Lazy loading**: Connect to servers only when needed
3. **Timeout configuration**: Set appropriate timeouts for MCP operations
4. **Resource cleanup**: Always close connections and clean up resources

### Error Handling

1. **Graceful degradation**: Handle MCP server failures gracefully
2. **Retry logic**: Implement retry mechanisms for transient failures
3. **Logging**: Log MCP operations for debugging and monitoring
4. **Fallback strategies**: Provide alternatives when MCP tools are unavailable

## Next Steps

- Learn about [tool calling](/docs/tool-calling) to understand how MCP tools integrate with Genkit
- Explore [creating flows](/docs/flows) to build workflows that leverage MCP capabilities
- See the [MCP Server guide](/docs/mcp-server) for creating your own MCP servers
- Check out the [official MCP documentation](https://modelcontextprotocol.io) for more details on the protocol
