---
title: Deploy with Cloud Run
description: Learn how to deploy Genkit flows to Google Cloud Run across JavaScript, Go, and Python with automatic scaling and containerization.
---

import LanguageSelector from '../../../../components/LanguageSelector.astro';
import CopyMarkdownButton from '../../../../components/CopyMarkdownButton.astro';
import LanguageContent from '../../../../components/LanguageContent.astro';

<div style="display: flex; justify-content: space-between; align-items: center; gap: 1rem; margin: 1rem 0 1rem 0;">
  <LanguageSelector />
  <CopyMarkdownButton />
</div>

Google Cloud Run provides a fully managed serverless platform for deploying Genkit flows as containerized applications. Cloud Run automatically scales your applications based on traffic and provides excellent performance with pay-per-use pricing.

## Key Features

- **Fully managed**: No infrastructure management required
- **Automatic scaling**: Scales to zero when not in use
- **Container-based**: Deploy any language or runtime
- **Global availability**: Deploy to multiple regions
- **Custom domains**: Support for custom domain mapping
- **Traffic splitting**: Blue-green deployments and gradual rollouts

## Prerequisites

- Google Cloud project with billing enabled
- Google Cloud CLI installed and configured
- Docker installed (for custom containers)
- Familiarity with [Genkit flows](/unified-docs/creating-flows)

## Setup

### Google Cloud Project Setup

<LanguageContent lang="js">
1. **Set up Google Cloud CLI**:
       ```bash
       gcloud auth login
       gcloud config set project your-project-id
       gcloud services enable run.googleapis.com
       ```

    2. **Create project directory**:
       ```bash
       mkdir my-genkit-cloudrun-app
       cd my-genkit-cloudrun-app
       npm init -y
       ```

    3. **Install dependencies**:
       ```bash
       npm install genkit @genkit-ai/googleai @genkit-ai/express
       npm install --save-dev typescript tsx
       ```
</LanguageContent>

<LanguageContent lang="go">
1. **Set up Google Cloud CLI**:
       ```bash
       gcloud auth login
       gcloud config set project your-project-id
       gcloud services enable run.googleapis.com
       ```

    2. **Create Go module**:
       ```bash
       mkdir my-genkit-cloudrun-app
       cd my-genkit-cloudrun-app
       go mod init example/cloudrun-app
       ```

    3. **Install dependencies**:
       ```bash
       go get github.com/firebase/genkit/go
       go get github.com/firebase/genkit/go/plugins/googlegenai
       go get github.com/firebase/genkit/go/plugins/server
       ```
</LanguageContent>

<LanguageContent lang="python">
1. **Set up Google Cloud CLI**:
       ```bash
       gcloud auth login
       gcloud config set project your-project-id
       gcloud services enable run.googleapis.com
       ```

    2. **Create Python project**:
       ```bash
       mkdir my-genkit-cloudrun-app
       cd my-genkit-cloudrun-app
       python -m venv venv
       source venv/bin/activate  # On Windows: venv\Scripts\activate
       ```

    3. **Install dependencies**:
       ```bash
       pip install genkit genkit-plugin-google-genai genkit-plugin-flask flask
       ```
</LanguageContent>

## Implementation

### Basic Application Setup

<LanguageContent lang="js">
Create `src/index.ts`:

    ```ts
    import { genkit, z } from 'genkit';
    import { googleAI } from '@genkit-ai/googleai';
    import { startFlowServer } from '@genkit-ai/express';

    const ai = genkit({
      plugins: [googleAI()],
      model: googleAI.model('gemini-2.5-flash'),
    });

    // Define your flows
    const generateJokeFlow = ai.defineFlow(
      {
        name: 'generateJoke',
        inputSchema: z.object({ topic: z.string() }),
        outputSchema: z.object({ joke: z.string() }),
      },
      async ({ topic }) => {
        const { text } = await ai.generate(
          `Tell a funny joke about ${topic}. Keep it clean and family-friendly.`
        );
        return { joke: text };
      }
    );

    const summarizeFlow = ai.defineFlow(
      {
        name: 'summarize',
        inputSchema: z.object({ text: z.string() }),
        outputSchema: z.object({ summary: z.string() }),
      },
      async ({ text }) => {
        const { text: summary } = await ai.generate(
          `Summarize the following text in 2-3 sentences: ${text}`
        );
        return { summary };
      }
    );

    // Start the flow server
    startFlowServer({
      flows: [generateJokeFlow, summarizeFlow],
      port: parseInt(process.env.PORT || '3400'),
      cors: {
        origin: true, // Allow all origins in development
        credentials: true,
      },
    });

    console.log(`Server running on port ${process.env.PORT || 3400}`);
    ```

    Create `package.json` scripts:

    ```json
    {
      "scripts": {
        "build": "tsc",
        "start": "node lib/index.js",
        "dev": "tsx src/index.ts"
      }
    }
    ```

    Create `tsconfig.json`:

    ```json
    {
      "compilerOptions": {
        "target": "ES2020",
        "module": "commonjs",
        "outDir": "./lib",
        "rootDir": "./src",
        "strict": true,
        "esModuleInterop": true,
        "skipLibCheck": true,
        "forceConsistentCasingInFileNames": true
      },
      "include": ["src/**/*"],
      "exclude": ["node_modules", "lib"]
    }
    ```
</LanguageContent>

<LanguageContent lang="go">
Create `main.go`:

    ```go
    package main

    import (
        "context"
        "fmt"
        "log"
        "net/http"
        "os"

        "github.com/firebase/genkit/go/ai"
        "github.com/firebase/genkit/go/genkit"
        "github.com/firebase/genkit/go/plugins/googlegenai"
        "github.com/firebase/genkit/go/plugins/server"
    )

    func main() {
        ctx := context.Background()

        // Initialize Genkit
        g, err := genkit.Init(ctx,
            genkit.WithPlugins(&googlegenai.GoogleAI{}),
            genkit.WithDefaultModel("googleai/gemini-2.5-flash"),
        )
        if err != nil {
            log.Fatalf("failed to initialize Genkit: %v", err)
        }

        // Define flows
        jokeFlow := genkit.DefineFlow(g, "generateJoke", 
            func(ctx context.Context, input struct{ Topic string }) (struct{ Joke string }, error) {
                resp, err := genkit.Generate(ctx, g,
                    ai.WithPrompt("Tell a funny joke about %s. Keep it clean and family-friendly.", input.Topic),
                )
                if err != nil {
                    return struct{ Joke string }{}, fmt.Errorf("failed to generate joke: %w", err)
                }
                return struct{ Joke string }{Joke: resp.Text()}, nil
            })

        summarizeFlow := genkit.DefineFlow(g, "summarize",
            func(ctx context.Context, input struct{ Text string }) (struct{ Summary string }, error) {
                resp, err := genkit.Generate(ctx, g,
                    ai.WithPrompt("Summarize the following text in 2-3 sentences: %s", input.Text),
                )
                if err != nil {
                    return struct{ Summary string }{}, fmt.Errorf("failed to summarize: %w", err)
                }
                return struct{ Summary string }{Summary: resp.Text()}, nil
            })

        // Set up HTTP routes
        mux := http.NewServeMux()
        
        // Add CORS middleware
        corsHandler := func(h http.Handler) http.Handler {
            return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
                w.Header().Set("Access-Control-Allow-Origin", "*")
                w.Header().Set("Access-Control-Allow-Methods", "POST, GET, OPTIONS")
                w.Header().Set("Access-Control-Allow-Headers", "Content-Type, Authorization")
                
                if r.Method == "OPTIONS" {
                    w.WriteHeader(http.StatusOK)
                    return
                }
                
                h.ServeHTTP(w, r)
            })
        }

        mux.Handle("POST /generateJoke", corsHandler(genkit.Handler(jokeFlow)))
        mux.Handle("POST /summarize", corsHandler(genkit.Handler(summarizeFlow)))

        // Health check endpoint
        mux.HandleFunc("GET /health", func(w http.ResponseWriter, r *http.Request) {
            w.WriteHeader(http.StatusOK)
            w.Write([]byte("OK"))
        })

        port := os.Getenv("PORT")
        if port == "" {
            port = "8080"
        }

        log.Printf("Server starting on port %s", port)
        log.Fatal(server.Start(ctx, "0.0.0.0:"+port, mux))
    }
    ```
</LanguageContent>

<LanguageContent lang="python">
Create `main.py`:

    ```python
    import os
    from flask import Flask

    from genkit.ai import Genkit
    from genkit.plugins.flask import genkit_flask_handler
    from genkit.plugins.google_genai import GoogleGenAI, google_genai_name

    # Initialize Genkit
    ai = Genkit(
        plugins=[GoogleGenAI()],
        model=google_genai_name('gemini-2.5-flash'),
    )

    app = Flask(__name__)

    @app.post('/generateJoke')
    @genkit_flask_handler(ai)
    @ai.flow()
    async def generate_joke(topic: str, ctx):
        response = await ai.generate(
            on_chunk=ctx.send_chunk,
            prompt=f'Tell a funny joke about {topic}. Keep it clean and family-friendly.',
        )
        return {'joke': response.text}

    @app.post('/summarize')
    @genkit_flask_handler(ai)
    @ai.flow()
    async def summarize(text: str, ctx):
        response = await ai.generate(
            on_chunk=ctx.send_chunk,
            prompt=f'Summarize the following text in 2-3 sentences: {text}',
        )
        return {'summary': response.text}

    @app.route('/health')
    def health_check():
        return 'OK', 200

    if __name__ == "__main__":
        port = int(os.environ.get("PORT", 8080))
        app.run(debug=False, host="0.0.0.0", port=port)
    ```

    Create `requirements.txt`:

    ```txt
    genkit
    genkit-plugin-google-genai
    genkit-plugin-flask
    flask
    gunicorn
    ```
</LanguageContent>

## Deployment

### Direct Source Deployment

<LanguageContent lang="js">
```bash
    # Deploy directly from source
    gcloud run deploy genkit-app \
      --source . \
      --platform managed \
      --region us-central1 \
      --allow-unauthenticated \
      --set-env-vars GOOGLE_CLOUD_PROJECT=your-project-id \
      --update-secrets GEMINI_API_KEY=gemini-api-key:latest

    # Deploy with custom settings
    gcloud run deploy genkit-app \
      --source . \
      --platform managed \
      --region us-central1 \
      --memory 1Gi \
      --cpu 1 \
      --timeout 300 \
      --concurrency 100 \
      --min-instances 0 \
      --max-instances 10 \
      --set-env-vars GOOGLE_CLOUD_PROJECT=your-project-id \
      --update-secrets GEMINI_API_KEY=gemini-api-key:latest
    ```
</LanguageContent>

<LanguageContent lang="go">
```bash
    # Deploy Go application
    gcloud run deploy genkit-go-app \
      --source . \
      --platform managed \
      --region us-central1 \
      --allow-unauthenticated \
      --set-env-vars GOOGLE_CLOUD_PROJECT=your-project-id \
      --update-secrets GEMINI_API_KEY=gemini-api-key:latest

    # Deploy with performance optimizations
    gcloud run deploy genkit-go-app \
      --source . \
      --platform managed \
      --region us-central1 \
      --memory 512Mi \
      --cpu 1 \
      --timeout 60 \
      --concurrency 1000 \
      --min-instances 1 \
      --max-instances 100 \
      --set-env-vars GOOGLE_CLOUD_PROJECT=your-project-id \
      --update-secrets GEMINI_API_KEY=gemini-api-key:latest
    ```
</LanguageContent>

<LanguageContent lang="python">
```bash
    # Deploy Python application
    gcloud run deploy genkit-python-app \
      --source . \
      --platform managed \
      --region us-central1 \
      --allow-unauthenticated \
      --set-env-vars GOOGLE_CLOUD_PROJECT=your-project-id \
      --update-secrets GEMINI_API_KEY=gemini-api-key:latest

    # Deploy with Gunicorn for production
    gcloud run deploy genkit-python-app \
      --source . \
      --platform managed \
      --region us-central1 \
      --memory 1Gi \
      --cpu 2 \
      --timeout 300 \
      --concurrency 80 \
      --set-env-vars GOOGLE_CLOUD_PROJECT=your-project-id \
      --update-secrets GEMINI_API_KEY=gemini-api-key:latest
    ```

    **For production, create a `Procfile`**:
    ```
    web: gunicorn --bind :$PORT --workers 1 --threads 8 --timeout 0 main:app
    ```
</LanguageContent>

## Testing Deployed Services

<LanguageContent lang="js">
```bash
    # Get service URL
    SERVICE_URL=$(gcloud run services describe genkit-app \
      --platform managed \
      --region us-central1 \
      --format 'value(status.url)')

    # Test joke generation
    curl -X POST $SERVICE_URL/generateJoke \
      -H "Content-Type: application/json" \
      -d '{"data": {"topic": "programming"}}'

    # Test with authentication
    curl -X POST $SERVICE_URL/generateJoke \
      -H "Content-Type: application/json" \
      -H "Authorization: Bearer $(gcloud auth print-identity-token)" \
      -d '{"data": {"topic": "programming"}}'
    ```
</LanguageContent>

<LanguageContent lang="go">
```bash
    # Get service URL
    SERVICE_URL=$(gcloud run services describe genkit-go-app \
      --platform managed \
      --region us-central1 \
      --format 'value(status.url)')

    # Test joke generation
    curl -X POST $SERVICE_URL/generateJoke \
      -H "Content-Type: application/json" \
      -d '{"topic": "programming"}'

    # Test health endpoint
    curl $SERVICE_URL/health
    ```
</LanguageContent>

<LanguageContent lang="python">
```bash
    # Get service URL
    SERVICE_URL=$(gcloud run services describe genkit-python-app \
      --platform managed \
      --region us-central1 \
      --format 'value(status.url)')

    # Test joke generation
    curl -X POST $SERVICE_URL/generateJoke \
      -H "Content-Type: application/json" \
      -d '{"data": "programming"}'

    # Test streaming response
    curl -X POST $SERVICE_URL/generateJoke \
      -H "Content-Type: application/json" \
      -H "Accept: text/event-stream" \
      -d '{"data": "programming"}'
    ```
</LanguageContent>

## Advanced Configuration

### Traffic Management

```bash
# Deploy new version without traffic
gcloud run deploy genkit-app \
  --source . \
  --no-traffic \
  --tag staging

# Gradually shift traffic
gcloud run services update-traffic genkit-app \
  --to-tags staging=10

# Complete the rollout
gcloud run services update-traffic genkit-app \
  --to-latest
```

### Custom Domains

```bash
# Map custom domain
gcloud run domain-mappings create \
  --service genkit-app \
  --domain api.yourdomain.com \
  --region us-central1
```

### VPC Connector

```bash
# Create VPC connector
gcloud compute networks vpc-access connectors create genkit-connector \
  --region us-central1 \
  --subnet default \
  --subnet-project your-project-id

# Deploy with VPC connector
gcloud run deploy genkit-app \
  --source . \
  --vpc-connector genkit-connector \
  --vpc-egress all-traffic
```

## Best Practices

### Security
1. **Never allow unauthenticated access** in production
2. **Use IAM roles** for service-to-service communication
3. **Store secrets securely** using Secret Manager
4. **Implement rate limiting** to prevent abuse
5. **Use HTTPS only** for all communications

### Performance
1. **Set appropriate resource limits** based on your workload
2. **Use minimum instances** for consistent performance
3. **Implement health checks** for better reliability
4. **Monitor cold start times** and optimize accordingly
5. **Use connection pooling** for external services

### Cost Management
1. **Set maximum instances** to control costs
2. **Use appropriate CPU and memory** allocations
3. **Monitor usage** with Cloud Monitoring
4. **Implement request timeout** to prevent runaway costs
5. **Use traffic splitting** for gradual rollouts

## Troubleshooting

### Common Issues

1. **Port binding errors**:
   - Ensure your app listens on `0.0.0.0:$PORT`
   - Cloud Run sets the PORT environment variable

2. **Memory issues**:
   - Increase memory allocation if needed
   - Monitor memory usage in Cloud Monitoring

3. **Timeout errors**:
   - Increase timeout settings for long-running operations
   - Implement proper error handling

4. **Secret access issues**:
   - Verify service account permissions
   - Check secret names and versions

## Next Steps

- Learn about [any platform deployment](/unified-docs/deployment/any-platform) for maximum flexibility
- Explore [authorization patterns](/unified-docs/deployment/authorization) for advanced security
- Check out [monitoring and observability](/unified-docs/observability-monitoring) for production insights
