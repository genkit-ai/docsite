---
title: Authentication and Setup
description: Learn how to set up authentication and permissions for Genkit observability and monitoring across JavaScript, Go, and Python environments.
---

import LanguageSelector from '../../../../components/LanguageSelector.astro';
import LanguageContent from '../../../../components/LanguageContent.astro';

<LanguageSelector />

This guide covers the authentication and setup requirements for enabling Genkit observability and monitoring in production environments.

## Prerequisites

Before setting up observability, ensure you have:

1. **Firebase Project**: A Firebase project with the Blaze pricing plan
2. **Google Cloud Project**: Access to the associated Google Cloud project
3. **Required APIs**: Enabled Google Cloud APIs for monitoring services
4. **Service Account**: Proper service account with necessary permissions

## Required Google Cloud APIs

Enable these APIs in your Google Cloud project:

- [Cloud Logging API](https://console.cloud.google.com/apis/library/logging.googleapis.com)
- [Cloud Trace API](https://console.cloud.google.com/apis/library/cloudtrace.googleapis.com)
- [Cloud Monitoring API](https://console.cloud.google.com/apis/library/monitoring.googleapis.com)

You can enable these APIs using the Google Cloud Console or the `gcloud` CLI:

```bash
gcloud services enable logging.googleapis.com
gcloud services enable cloudtrace.googleapis.com
gcloud services enable monitoring.googleapis.com
```

## Service Account Setup

### Required IAM Roles

Grant the following roles to your service account:

- **Monitoring Metric Writer** (`roles/monitoring.metricWriter`)
- **Cloud Trace Agent** (`roles/cloudtrace.agent`)
- **Logs Writer** (`roles/logging.logWriter`)

### Creating a Service Account

<LanguageContent lang="google cloud console">
1. Go to the [IAM & Admin > Service Accounts](https://console.cloud.google.com/iam-admin/serviceaccounts) page
    2. Click **Create Service Account**
    3. Enter a name and description for the service account
    4. Click **Create and Continue**
    5. Add the required roles:
       - Monitoring Metric Writer
       - Cloud Trace Agent
       - Logs Writer
    6. Click **Continue** and then **Done**
    7. Download the service account key JSON file
</LanguageContent>

<LanguageContent lang="gcloud cli">
```bash
    # Create service account
    gcloud iam service-accounts create genkit-monitoring \
        --display-name="Genkit Monitoring Service Account"

    # Get your project ID
    PROJECT_ID=$(gcloud config get-value project)

    # Grant required roles
    gcloud projects add-iam-policy-binding $PROJECT_ID \
        --member="serviceAccount:genkit-monitoring@$PROJECT_ID.iam.gserviceaccount.com" \
        --role="roles/monitoring.metricWriter"

    gcloud projects add-iam-policy-binding $PROJECT_ID \
        --member="serviceAccount:genkit-monitoring@$PROJECT_ID.iam.gserviceaccount.com" \
        --role="roles/cloudtrace.agent"

    gcloud projects add-iam-policy-binding $PROJECT_ID \
        --member="serviceAccount:genkit-monitoring@$PROJECT_ID.iam.gserviceaccount.com" \
        --role="roles/logging.logWriter"

    # Create and download key
    gcloud iam service-accounts keys create genkit-monitoring-key.json \
        --iam-account=genkit-monitoring@$PROJECT_ID.iam.gserviceaccount.com
    ```
</LanguageContent>

## Authentication Configuration

### Environment Variables

Set up authentication using environment variables:

```bash
# Path to service account key file
export GOOGLE_APPLICATION_CREDENTIALS="/path/to/genkit-monitoring-key.json"

# Or set the project ID directly
export GOOGLE_CLOUD_PROJECT="your-project-id"
```

### Application Default Credentials

For production deployments, use Application Default Credentials (ADC):

<LanguageContent lang="cloud functions">
Cloud Functions automatically use the default service account. Ensure it has the required roles:

    ```bash
    # Get the default service account
    PROJECT_ID=$(gcloud config get-value project)
    DEFAULT_SA="$PROJECT_ID@appspot.gserviceaccount.com"

    # Grant required roles
    gcloud projects add-iam-policy-binding $PROJECT_ID \
        --member="serviceAccount:$DEFAULT_SA" \
        --role="roles/monitoring.metricWriter"

    gcloud projects add-iam-policy-binding $PROJECT_ID \
        --member="serviceAccount:$DEFAULT_SA" \
        --role="roles/cloudtrace.agent"

    gcloud projects add-iam-policy-binding $PROJECT_ID \
        --member="serviceAccount:$DEFAULT_SA" \
        --role="roles/logging.logWriter"
    ```
</LanguageContent>

<LanguageContent lang="cloud run">
Specify a custom service account when deploying:

    ```bash
    gcloud run deploy genkit-app \
        --image gcr.io/PROJECT_ID/genkit-app \
        --service-account genkit-monitoring@PROJECT_ID.iam.gserviceaccount.com \
        --region us-central1
    ```
</LanguageContent>

<LanguageContent lang="compute engine">
Attach the service account to your VM instance:

    ```bash
    gcloud compute instances create genkit-vm \
        --service-account genkit-monitoring@PROJECT_ID.iam.gserviceaccount.com \
        --scopes cloud-platform
    ```
</LanguageContent>

## Language-Specific Setup

### JavaScript/Node.js

<LanguageContent lang="environment variables">
```bash
    # Set environment variables
    export GOOGLE_APPLICATION_CREDENTIALS="/path/to/key.json"
    export ENABLE_FIREBASE_MONITORING=true
    ```

    ```ts
    import { enableFirebaseTelemetry } from '@genkit-ai/firebase';

    // Automatically uses GOOGLE_APPLICATION_CREDENTIALS
    enableFirebaseTelemetry();
    ```
</LanguageContent>

<LanguageContent lang="programmatic">
```ts
    import { enableFirebaseTelemetry } from '@genkit-ai/firebase';

    enableFirebaseTelemetry({
      projectId: 'your-project-id',
      // Optional: specify credentials path
      keyFilename: '/path/to/key.json',
    });
    ```
</LanguageContent>

### Go

<LanguageContent lang="environment variables">
```bash
    export GOOGLE_APPLICATION_CREDENTIALS="/path/to/key.json"
    export GOOGLE_CLOUD_PROJECT="your-project-id"
    ```

    ```go
    import (
        "github.com/firebase/genkit/go/plugins/googlecloud"
    )

    func main() {
        ctx := context.Background()
        
        g, err := genkit.Init(ctx,
            genkit.WithPlugins(&googlecloud.GoogleCloud{}),
        )
        if err != nil {
            log.Fatal(err)
        }
    }
    ```
</LanguageContent>

<LanguageContent lang="programmatic">
```go
    import (
        "google.golang.org/api/option"
        "github.com/firebase/genkit/go/plugins/googlecloud"
    )

    func main() {
        ctx := context.Background()
        
        g, err := genkit.Init(ctx,
            genkit.WithPlugins(&googlecloud.GoogleCloud{
                ProjectID: "your-project-id",
                ClientOptions: []option.ClientOption{
                    option.WithCredentialsFile("/path/to/key.json"),
                },
            }),
        )
        if err != nil {
            log.Fatal(err)
        }
    }
    ```
</LanguageContent>

### Python

<LanguageContent lang="environment variables">
```bash
    export GOOGLE_APPLICATION_CREDENTIALS="/path/to/key.json"
    export GOOGLE_CLOUD_PROJECT="your-project-id"
    ```

    ```python
    from genkit.ai import Genkit
    from genkit.monitoring import enable_firebase_monitoring

    # Automatically uses environment variables
    enable_firebase_monitoring()

    ai = Genkit()
    ```
</LanguageContent>

<LanguageContent lang="programmatic">
```python
    from genkit.ai import Genkit
    from genkit.monitoring import enable_firebase_monitoring

    enable_firebase_monitoring(
        project_id='your-project-id',
        credentials_path='/path/to/key.json'
    )

    ai = Genkit()
    ```
</LanguageContent>

## Local Development Authentication

For local development and testing, you can use your personal Google Cloud credentials:

### Using gcloud CLI

```bash
# Authenticate with your Google account
gcloud auth application-default login

# Set the project
gcloud config set project your-project-id
```

### Impersonating Service Accounts

For testing with service account permissions locally:

```bash
# Impersonate the service account
gcloud auth application-default login \
    --impersonate-service-account genkit-monitoring@your-project-id.iam.gserviceaccount.com
```

**Note**: You need the `roles/iam.serviceAccountTokenCreator` role to impersonate service accounts.

## Testing Authentication

Verify your authentication setup:

<LanguageContent lang="js">
```ts
    import { enableFirebaseTelemetry } from '@genkit-ai/firebase';

    // Enable with local testing
    enableFirebaseTelemetry({
      forceDevExport: true,
      metricExportIntervalMillis: 10_000, // 10 seconds for testing
    });

    // Test with a simple flow
    export const testFlow = ai.defineFlow(
      { name: 'testFlow' },
      async () => {
        console.log('Testing observability...');
        return 'Authentication successful!';
      }
    );
    ```
</LanguageContent>

<LanguageContent lang="go">
```go
    func testAuthentication() {
        ctx := context.Background()
        
        g, err := genkit.Init(ctx,
            genkit.WithPlugins(&googlecloud.GoogleCloud{}),
        )
        if err != nil {
            log.Fatalf("Authentication failed: %v", err)
        }

        testFlow := genkit.DefineFlow(g, "testFlow",
            func(ctx context.Context, input string) (string, error) {
                log.Println("Testing observability...")
                return "Authentication successful!", nil
            })
        
        // Run the test flow
        result, err := testFlow.Run(ctx, "test")
        if err != nil {
            log.Fatalf("Test failed: %v", err)
        }
        
        log.Printf("Test result: %s", result)
    }
    ```
</LanguageContent>

<LanguageContent lang="python">
```python
    from genkit.ai import Genkit
    from genkit.monitoring import enable_firebase_monitoring

    try:
        enable_firebase_monitoring(force_dev_export=True)
        ai = Genkit()

        @ai.flow()
        async def test_flow() -> str:
            print("Testing observability...")
            return "Authentication successful!"

        # Test the flow
        result = await test_flow()
        print(f"Test result: {result}")
        
    except Exception as e:
        print(f"Authentication failed: {e}")
    ```
</LanguageContent>

## Security Best Practices

### Service Account Security

1. **Principle of Least Privilege**: Only grant the minimum required roles
2. **Key Rotation**: Regularly rotate service account keys
3. **Key Storage**: Store keys securely and never commit them to version control
4. **Access Monitoring**: Monitor service account usage and access patterns

### Environment Security

1. **Environment Separation**: Use different service accounts for dev/staging/prod
2. **Secret Management**: Use secret management services for credentials
3. **Network Security**: Restrict network access to monitoring endpoints
4. **Audit Logging**: Enable audit logging for service account activities

### Credential Management

```bash
# Example: Using Google Secret Manager
gcloud secrets create genkit-monitoring-key --data-file=key.json

# Grant access to the secret
gcloud secrets add-iam-policy-binding genkit-monitoring-key \
    --member="serviceAccount:your-app@your-project.iam.gserviceaccount.com" \
    --role="roles/secretmanager.secretAccessor"
```

## Troubleshooting Authentication

### Common Issues

**Permission Denied Errors**:
- Verify service account has required roles
- Check that APIs are enabled
- Ensure credentials are properly configured

**Authentication Not Found**:
- Verify `GOOGLE_APPLICATION_CREDENTIALS` path
- Check service account key file exists and is readable
- Ensure project ID is correctly set

**Quota Exceeded**:
- Check API quotas and limits
- Verify billing is enabled for the project
- Monitor usage in the Google Cloud Console

### Debugging Commands

```bash
# Check current authentication
gcloud auth list

# Verify project configuration
gcloud config list

# Test API access
gcloud logging logs list --limit=1

# Check service account permissions
gcloud projects get-iam-policy your-project-id \
    --flatten="bindings[].members" \
    --filter="bindings.members:serviceAccount:your-sa@your-project.iam.gserviceaccount.com"
```

## Next Steps

- Configure [advanced monitoring options](/unified-docs/observability/advanced-configuration)
- Learn about [troubleshooting common issues](/unified-docs/observability/troubleshooting)
- Explore the main [observability and monitoring guide](/unified-docs/observability-monitoring)
- Set up [production deployment](/unified-docs/deployment) with proper monitoring
