---
title: Troubleshooting
description: Common issues and solutions for Genkit observability and monitoring across JavaScript, Go, and Python environments.
---

import LanguageSelector from '../../../../components/LanguageSelector.astro';
import LanguageContent from '../../../../components/LanguageContent.astro';

<LanguageSelector />

This guide helps you diagnose and resolve common issues with Genkit's observability and monitoring features.

## Common Issues

### Metrics Not Appearing in Dashboard

**Symptoms:**
- No metrics visible in the Firebase Genkit Monitoring dashboard
- Empty charts or "No data available" messages
- Metrics appear locally but not in production

**Possible Causes and Solutions:**

<LanguageContent lang="js">
**1. Check Firebase plugin configuration:**
    ```ts
    import { enableFirebaseTelemetry } from '@genkit-ai/firebase';

    // Verify telemetry is enabled
    enableFirebaseTelemetry({
      forceDevExport: true, // For testing
      metricExportIntervalMillis: 10_000, // Faster for testing
    });
    ```

    **2. Verify environment variables:**
    ```bash
    echo $GOOGLE_APPLICATION_CREDENTIALS
    echo $GOOGLE_CLOUD_PROJECT
    echo $ENABLE_FIREBASE_MONITORING
    ```

    **3. Check API permissions:**
    ```bash
    # Test if APIs are accessible
    gcloud logging logs list --limit=1
    gcloud monitoring metrics list --limit=1
    ```
</LanguageContent>

<LanguageContent lang="go">
**1. Verify Google Cloud plugin setup:**
    ```go
    import (
        "github.com/firebase/genkit/go/plugins/googlecloud"
    )

    func main() {
        ctx := context.Background()
        
        g, err := genkit.Init(ctx,
            genkit.WithPlugins(&googlecloud.GoogleCloud{}),
        )
        if err != nil {
            log.Fatalf("Failed to initialize Genkit: %v", err)
        }
        
        log.Println("Genkit initialized successfully")
    }
    ```

    **2. Check environment setup:**
    ```bash
    echo $GOOGLE_APPLICATION_CREDENTIALS
    echo $GOOGLE_CLOUD_PROJECT
    ```

    **3. Test authentication:**
    ```go
    // Add to your main function for testing
    client, err := monitoring.NewMetricClient(ctx)
    if err != nil {
        log.Fatalf("Failed to create monitoring client: %v", err)
    }
    defer client.Close()
    log.Println("Monitoring client created successfully")
    ```
</LanguageContent>

<LanguageContent lang="python">
**1. Verify monitoring setup:**
    ```python
    from genkit.ai import Genkit
    from genkit.monitoring import enable_firebase_monitoring

    try:
        enable_firebase_monitoring(force_dev_export=True)
        print("Monitoring enabled successfully")
    except Exception as e:
        print(f"Failed to enable monitoring: {e}")

    ai = Genkit()
    ```

    **2. Check dependencies:**
    ```bash
    pip list | grep -E "(genkit|google|opentelemetry)"
    ```

    **3. Test authentication:**
    ```python
    from google.cloud import monitoring_v3

    try:
        client = monitoring_v3.MetricServiceClient()
        project_name = f"projects/{your_project_id}"
        metrics = client.list_metric_descriptors(name=project_name)
        print("Authentication successful")
    except Exception as e:
        print(f"Authentication failed: {e}")
    ```
</LanguageContent>

### Authentication and Permission Issues

**Symptoms:**
- "Permission denied" errors
- "Authentication failed" messages
- 403 or 401 HTTP status codes

**Solutions:**

**1. Verify IAM roles:**
```bash
# Check service account permissions
gcloud projects get-iam-policy YOUR_PROJECT_ID \
    --flatten="bindings[].members" \
    --filter="bindings.members:serviceAccount:YOUR_SERVICE_ACCOUNT"
```

**2. Required roles checklist:**
- ✅ `roles/monitoring.metricWriter`
- ✅ `roles/cloudtrace.agent`
- ✅ `roles/logging.logWriter`

**3. Test service account:**
```bash
# Impersonate service account for testing
gcloud auth application-default login \
    --impersonate-service-account YOUR_SERVICE_ACCOUNT
```

**4. Verify API enablement:**
```bash
gcloud services list --enabled --filter="name:(logging|monitoring|cloudtrace)"
```

### High Telemetry Costs

**Symptoms:**
- Unexpected Google Cloud billing charges
- High volume of telemetry data
- Performance impact from telemetry collection

**Solutions:**

<LanguageContent lang="js">
**1. Implement sampling:**
    ```ts
    import { TraceIdRatioBasedSampler } from '@opentelemetry/sdk-trace-base';

    enableFirebaseTelemetry({
      // Sample only 10% of traces
      sampler: new TraceIdRatioBasedSampler(0.1),
      
      // Increase export intervals
      metricExportIntervalMillis: 600_000, // 10 minutes
      
      // Disable input/output logging
      disableLoggingInputAndOutput: true,
    });
    ```

    **2. Disable unnecessary instrumentation:**
    ```ts
    enableFirebaseTelemetry({
      autoInstrumentationConfig: {
        '@opentelemetry/instrumentation-fs': { enabled: false },
        '@opentelemetry/instrumentation-dns': { enabled: false },
        '@opentelemetry/instrumentation-net': { enabled: false },
      },
    });
    ```
</LanguageContent>

<LanguageContent lang="go">
**1. Configure sampling:**
    ```go
    import "go.opentelemetry.io/otel/sdk/trace"

    // 10% sampling
    sampler := trace.TraceIDRatioBased(0.1)
    
    tp := trace.NewTracerProvider(
        trace.WithSampler(sampler),
    )
    
    otel.SetTracerProvider(tp)
    ```

    **2. Optimize batch processing:**
    ```go
    batchProcessor := trace.NewBatchSpanProcessor(
        exporter,
        trace.WithBatchTimeout(60*time.Second), // Longer batches
        trace.WithMaxExportBatchSize(1024),     // Larger batches
    )
    ```
</LanguageContent>

<LanguageContent lang="python">
**1. Reduce sampling rate:**
    ```python
    enable_firebase_monitoring(
        sampling_rate=0.1,  # 10% sampling
        export_interval=600,  # 10 minutes
        disable_input_output_logging=True,
    )
    ```

    **2. Optimize batch settings:**
    ```python
    from opentelemetry.sdk.trace.export import BatchSpanProcessor

    batch_processor = BatchSpanProcessor(
        exporter,
        max_export_batch_size=1024,
        schedule_delay_millis=60000,  # 1 minute
    )
    ```
</LanguageContent>

### Missing Traces in Production

**Symptoms:**
- Traces visible in development but not production
- Incomplete trace data
- Gaps in trace timeline

**Solutions:**

**1. Check sampling configuration:**
- Ensure sampling rate isn't too low
- Verify parent-based sampling isn't dropping traces
- Test with higher sampling rates temporarily

**2. Verify network connectivity:**
```bash
# Test connectivity to Google Cloud endpoints
curl -I https://cloudtrace.googleapis.com/
curl -I https://monitoring.googleapis.com/
```

**3. Check export configuration:**

<LanguageContent lang="js">
```ts
    // Add debugging to trace export
    enableFirebaseTelemetry({
      // Enable debug logging
      debug: true,
      
      // Reduce export timeout for testing
      metricExportTimeoutMillis: 10_000,
      
      // Force export in all environments
      forceDevExport: true,
    });
    ```
</LanguageContent>

<LanguageContent lang="go">
```go
    // Add logging to trace export
    import "go.opentelemetry.io/otel/exporters/stdout/stdouttrace"

    // For debugging, add stdout exporter
    stdoutExporter, err := stdouttrace.New(
        stdouttrace.WithPrettyPrint(),
    )
    if err != nil {
        log.Fatal(err)
    }

    tp := trace.NewTracerProvider(
        trace.WithSpanProcessor(trace.NewSimpleSpanProcessor(stdoutExporter)),
    )
    ```
</LanguageContent>

<LanguageContent lang="python">
```python
    # Enable debug logging
    import logging
    logging.basicConfig(level=logging.DEBUG)

    # Add console exporter for debugging
    from opentelemetry.exporter.console import ConsoleSpanExporter
    from opentelemetry.sdk.trace.export import SimpleSpanProcessor

    console_exporter = ConsoleSpanExporter()
    trace_provider.add_span_processor(
        SimpleSpanProcessor(console_exporter)
    )
    ```
</LanguageContent>

### Performance Issues

**Symptoms:**
- Increased application latency
- High CPU or memory usage
- Slow response times

**Solutions:**

**1. Optimize telemetry overhead:**

<LanguageContent lang="js">
```ts
    // Reduce telemetry overhead
    enableFirebaseTelemetry({
      // Use batch processing
      spanProcessorConfig: {
        maxExportBatchSize: 512,
        scheduledDelayMillis: 5000,
        maxQueueSize: 2048,
      },
      
      // Disable expensive instrumentations
      autoInstrumentationConfig: {
        '@opentelemetry/instrumentation-fs': { enabled: false },
        '@opentelemetry/instrumentation-dns': { enabled: false },
      },
    });
    ```
</LanguageContent>

<LanguageContent lang="go">
```go
    // Optimize span processing
    batchProcessor := trace.NewBatchSpanProcessor(
        exporter,
        trace.WithBatchTimeout(5*time.Second),
        trace.WithMaxExportBatchSize(512),
        trace.WithMaxQueueSize(2048),
    )
    
    tp := trace.NewTracerProvider(
        trace.WithSpanProcessor(batchProcessor),
        trace.WithSampler(trace.TraceIDRatioBased(0.1)),
    )
    ```
</LanguageContent>

<LanguageContent lang="python">
```python
    # Optimize performance
    enable_firebase_monitoring(
        sampling_rate=0.1,
        batch_size=512,
        schedule_delay_millis=5000,
        max_queue_size=2048,
    )
    ```
</LanguageContent>

**2. Monitor resource usage:**

<LanguageContent lang="js">
```ts
    // Monitor memory usage
    setInterval(() => {
      const usage = process.memoryUsage();
      console.log('Memory usage:', {
        heapUsed: Math.round(usage.heapUsed / 1024 / 1024) + 'MB',
        heapTotal: Math.round(usage.heapTotal / 1024 / 1024) + 'MB',
        rss: Math.round(usage.rss / 1024 / 1024) + 'MB',
      });
    }, 30000);
    ```
</LanguageContent>

<LanguageContent lang="go">
```go
    // Monitor memory usage
    import "runtime"

    func logMemoryUsage() {
        var m runtime.MemStats
        runtime.ReadMemStats(&m)
        
        log.Printf("Memory usage: Alloc=%dMB, Sys=%dMB, NumGC=%d",
            m.Alloc/1024/1024, m.Sys/1024/1024, m.NumGC)
    }

    // Call periodically
    go func() {
        for {
            logMemoryUsage()
            time.Sleep(30 * time.Second)
        }
    }()
    ```
</LanguageContent>

<LanguageContent lang="python">
```python
    import psutil
    import threading
    import time

    def monitor_memory():
        while True:
            process = psutil.Process()
            memory_info = process.memory_info()
            print(f"Memory usage: RSS={memory_info.rss // 1024 // 1024}MB, "
                  f"VMS={memory_info.vms // 1024 // 1024}MB")
            time.sleep(30)

    # Start monitoring thread
    monitor_thread = threading.Thread(target=monitor_memory, daemon=True)
    monitor_thread.start()
    ```
</LanguageContent>

## Debugging Tools

### Enable Debug Logging

<LanguageContent lang="js">
```ts
    // Enable OpenTelemetry debug logging
    process.env.OTEL_LOG_LEVEL = 'debug';

    // Enable Genkit debug logging
    import { logger } from 'genkit/logging';
    logger.setLogLevel('debug');

    // Log telemetry configuration
    enableFirebaseTelemetry({
      debug: true,
      // ... other config
    });
    ```
</LanguageContent>

<LanguageContent lang="go">
```go
    import (
        "log/slog"
        "os"
    )

    // Enable debug logging
    logger := slog.New(slog.NewTextHandler(os.Stdout, &slog.HandlerOptions{
        Level: slog.LevelDebug,
    }))
    slog.SetDefault(logger)

    // Log telemetry events
    slog.Debug("Telemetry configuration", "config", config)
    ```
</LanguageContent>

<LanguageContent lang="python">
```python
    import logging
    import os

    # Enable debug logging
    logging.basicConfig(
        level=logging.DEBUG,
        format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
    )

    # Enable OpenTelemetry debug logging
    os.environ['OTEL_LOG_LEVEL'] = 'debug'

    # Log monitoring setup
    logger = logging.getLogger(__name__)
    logger.debug("Enabling Firebase monitoring")
    ```
</LanguageContent>

### Test Telemetry Export

<LanguageContent lang="js">
```ts
    // Test telemetry export with console output
    import { ConsoleSpanExporter } from '@opentelemetry/exporter-console';
    import { SimpleSpanProcessor } from '@opentelemetry/sdk-trace-base';

    const consoleExporter = new ConsoleSpanExporter();
    const processor = new SimpleSpanProcessor(consoleExporter);

    // Add to tracer provider for debugging
    const tp = new TracerProvider({
      spanProcessors: [processor],
    });
    ```
</LanguageContent>

<LanguageContent lang="go">
```go
    // Test with stdout exporter
    import "go.opentelemetry.io/otel/exporters/stdout/stdouttrace"

    stdoutExporter, err := stdouttrace.New(
        stdouttrace.WithPrettyPrint(),
    )
    if err != nil {
        log.Fatal(err)
    }

    tp := trace.NewTracerProvider(
        trace.WithSpanProcessor(trace.NewSimpleSpanProcessor(stdoutExporter)),
    )
    ```
</LanguageContent>

<LanguageContent lang="python">
```python
    # Test with console exporter
    from opentelemetry.exporter.console import ConsoleSpanExporter
    from opentelemetry.sdk.trace.export import SimpleSpanProcessor

    console_exporter = ConsoleSpanExporter()
    trace_provider.add_span_processor(
        SimpleSpanProcessor(console_exporter)
    )
    ```
</LanguageContent>

### Validate Configuration

<LanguageContent lang="js">
```ts
    // Configuration validation function
    function validateTelemetryConfig() {
      console.log('Environment variables:');
      console.log('GOOGLE_APPLICATION_CREDENTIALS:', process.env.GOOGLE_APPLICATION_CREDENTIALS);
      console.log('GOOGLE_CLOUD_PROJECT:', process.env.GOOGLE_CLOUD_PROJECT);
      console.log('ENABLE_FIREBASE_MONITORING:', process.env.ENABLE_FIREBASE_MONITORING);
      
      // Test API access
      const { GoogleAuth } = require('google-auth-library');
      const auth = new GoogleAuth();
      
      auth.getProjectId()
        .then(projectId => console.log('Project ID:', projectId))
        .catch(err => console.error('Auth error:', err));
    }

    validateTelemetryConfig();
    ```
</LanguageContent>

<LanguageContent lang="go">
```go
    func validateTelemetryConfig() {
        log.Println("Environment variables:")
        log.Println("GOOGLE_APPLICATION_CREDENTIALS:", os.Getenv("GOOGLE_APPLICATION_CREDENTIALS"))
        log.Println("GOOGLE_CLOUD_PROJECT:", os.Getenv("GOOGLE_CLOUD_PROJECT"))
        
        // Test authentication
        ctx := context.Background()
        creds, err := google.FindDefaultCredentials(ctx)
        if err != nil {
            log.Printf("Credentials error: %v", err)
        } else {
            log.Printf("Project ID: %s", creds.ProjectID)
        }
    }
    ```
</LanguageContent>

<LanguageContent lang="python">
```python
    def validate_telemetry_config():
        import os
        from google.auth import default

        print("Environment variables:")
        print(f"GOOGLE_APPLICATION_CREDENTIALS: {os.getenv('GOOGLE_APPLICATION_CREDENTIALS')}")
        print(f"GOOGLE_CLOUD_PROJECT: {os.getenv('GOOGLE_CLOUD_PROJECT')}")
        
        try:
            credentials, project_id = default()
            print(f"Project ID: {project_id}")
            print("Authentication successful")
        except Exception as e:
            print(f"Authentication error: {e}")

    validate_telemetry_config()
    ```
</LanguageContent>

## Monitoring Health

### Check Telemetry Pipeline

```bash
# Check if telemetry data is being generated
gcloud logging read "resource.type=global" --limit=10 --format="table(timestamp,severity,textPayload)"

# Check metrics
gcloud monitoring metrics list --filter="metric.type:genkit" --limit=10

# Check traces
gcloud trace list-traces --limit=10
```

### Monitor Export Success

<LanguageContent lang="js">
```ts
    // Monitor export success/failure
    import { metrics } from '@opentelemetry/api';

    const meter = metrics.getMeter('telemetry-health');
    const exportSuccess = meter.createCounter('telemetry_export_success_total');
    const exportFailure = meter.createCounter('telemetry_export_failure_total');

    // Custom exporter wrapper
    class MonitoredExporter {
      constructor(baseExporter) {
        this.baseExporter = baseExporter;
      }

      export(spans, resultCallback) {
        this.baseExporter.export(spans, (result) => {
          if (result.code === ExportResultCode.SUCCESS) {
            exportSuccess.add(1);
          } else {
            exportFailure.add(1);
            console.error('Export failed:', result.error);
          }
          resultCallback(result);
        });
      }
    }
    ```
</LanguageContent>

<LanguageContent lang="go">
```go
    // Monitor export health
    type MonitoredExporter struct {
        base trace.SpanExporter
        successCounter metric.Int64Counter
        failureCounter metric.Int64Counter
    }

    func (e *MonitoredExporter) ExportSpans(ctx context.Context, spans []trace.ReadOnlySpan) error {
        err := e.base.ExportSpans(ctx, spans)
        if err != nil {
            e.failureCounter.Add(ctx, 1)
            log.Printf("Export failed: %v", err)
        } else {
            e.successCounter.Add(ctx, 1)
        }
        return err
    }
    ```
</LanguageContent>

<LanguageContent lang="python">
```python
    # Monitor export health
    from opentelemetry.sdk.trace.export import SpanExporter, SpanExportResult

    class MonitoredExporter(SpanExporter):
        def __init__(self, base_exporter):
            self.base_exporter = base_exporter
            self.success_count = 0
            self.failure_count = 0

        def export(self, spans):
            try:
                result = self.base_exporter.export(spans)
                if result == SpanExportResult.SUCCESS:
                    self.success_count += 1
                else:
                    self.failure_count += 1
                    print(f"Export failed: {result}")
                return result
            except Exception as e:
                self.failure_count += 1
                print(f"Export error: {e}")
                return SpanExportResult.FAILURE
    ```
</LanguageContent>

## Getting Help

### Collect Diagnostic Information

When reporting issues, include:

1. **Environment details:**
   - Operating system and version
   - Language runtime version
   - Genkit version
   - Cloud environment (local, Cloud Run, etc.)

2. **Configuration:**
   - Telemetry configuration
   - Environment variables
   - IAM roles and permissions

3. **Error messages:**
   - Complete error logs
   - Stack traces
   - Console output

4. **Reproduction steps:**
   - Minimal code example
   - Steps to reproduce the issue
   - Expected vs actual behavior

### Useful Commands

```bash
# Check Genkit version
npm list genkit  # JavaScript
go list -m github.com/firebase/genkit/go  # Go
pip show genkit  # Python

# Check Google Cloud SDK
gcloud version

# Test authentication
gcloud auth list
gcloud config list

# Check API access
gcloud services list --enabled
gcloud projects get-iam-policy PROJECT_ID

# View logs
gcloud logging read "resource.type=global" --limit=50
```

### Community Resources

- [Genkit GitHub Issues](https://github.com/firebase/genkit/issues)
- [Firebase Community](https://firebase.google.com/community)
- [Stack Overflow](https://stackoverflow.com/questions/tagged/genkit)
- [Google Cloud Support](https://cloud.google.com/support)

## Next Steps

- Review the main [observability and monitoring guide](/unified-docs/observability-monitoring)
- Check [authentication and setup](/unified-docs/observability/authentication) requirements
- Explore [advanced configuration](/unified-docs/observability/advanced-configuration) options
- Learn about [deployment best practices](/unified-docs/deployment)
